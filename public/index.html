<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ちいかわ Image Gen</title>
    <link rel="stylesheet" href="css/mask.css">
    <link rel="stylesheet" href="css/story-protocol.css">
    <link rel="stylesheet" href="css/IPregister.css">
    <script src="https://unpkg.com/konva@8.0.2/konva.min.js"></script>
    
     <!-- Include Axios from CDN -->
     <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="container" style="margin-top: 100px;">
        <h1>ちいかわ</h1>
    </div>
    <div class="container" style="margin-top: 20px;"> 
        <div id="imageContainer">
            <img src="image/chiikawa_rgba.png" id="sourceImage" alt="Image">
            <canvas id="canvasMask" width="248" height="248"></canvas>
        </div>
    </div>
    <div class="container" style="margin-top: 10px;">
        <div id="imageUrlContainer"><!-- Image URL will be displayed here --></div>
    </div>
    <div class="container" style="margin-top: 10px;">
        <button onclick="confirmMask()">Confirm Mask Selection</button>      
    </div>
    <div class="container" style="text-align: center;">
        <h4>Left-click three times on the canvas and drag to start creating a mask.<br>Use mouse wheel to change the circle size.<br>Confirm the mask selection and type in prompt to generate a new image.<br>Enjoy creating pics!</h4>
    </div>
    <div class="container" style="margin-top: 30px;">
        <textarea id="textBox" placeholder="Enter text here..."></textarea>
    </div>
    <div class="container" style="margin-top: 10px;">
        <button id="generateButton">Generate</button>
    </div>
      
    <!-- Story Protocol area -->
    <div class="chatbot-container" id="chatbotContainer">
        
        <div class="chatbot-header" onclick="toggleChatbot()">
            <h2>Story Protocol</h2>        
        </div>

        <div class="container">
            <button class="metamask-button" id="connectButton">
              <img src="image/metamask.png "  alt="metamask logo" /> Connect wallet
              <span id="loading"><span>&bull;</span><span>&bull;</span><span>&bull;</span></span></button>
            <div id="walletID">Your wallet is not connected yet.</div>
            <div id="mobileDeviceWarning">If you are on a mobile phone, please use MetaMask application's browser to connect.</div>
          </div>
          <div class="alert" id="installAlert">Please refresh your browser after installing the Metamask plugin<button class="button" id="">Reload page</button></div>
       
        <div id="chatMessages">
            <p>1. Copy the image url <br>
                2. <a target="_blank" href="https://sepolia.etherscan.io/address/0x7ee32b8B515dEE0Ba2F25f612A04a731eEc24F49#writeContract">Mint an NFT</a>(select 4)<br>
                3. Sign in with metamask, enter your wallet address and image url<br>
                4. Come back and register an IP asset <br>
            </p>
            
        </div>
        <button class="story-button" id="IPA-button"  style="visibility: hidden;">
            <img src="image/story.jpeg" width="30px" height="30px" alt="metamask logo" /> Register an IP asset</button>
    </div>
    
        <!-- Modal overlay container -->
        <div id="modalOverlay" class="modal-overlay">
            <div class="modal-content">
            <span class="close" id="modalClose">&times;</span> <!-- Close button (x) -->
            <div class="modal-header">
                <h2>Register IP Asset</h2>
            </div>
            <div class="modal-form">
                <label for="IPid">IP Asset ID:</label>
                <input type="text" id="IPid" value="0x11aF788cc340b0Ae6aB18703e36DcaA7294aF340" readonly class="modal-input" style="width: 480px;">
            </div>
            <div class="modal-form">
                <label for="Tokenid">NFT Token ID:</label>
                <input type="text" id="Tokenid" class="modal-input" style="width: 480px;">
            </div>
            <button onclick="createIPAsset()" class="modal-button">Create</button>
            </div>
        </div>
  
  

    <script>
        function toggleChatbot() {
            var chatbotContainer = document.getElementById('chatbotContainer');
            if (chatbotContainer.style.height === '400px') {
                chatbotContainer.style.height = '50px'; // Toggle to collapsed state
            } else {
                chatbotContainer.style.height = '400px'; // Toggle to expanded state
            }
        }
       
    </script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script src="js/metamask.js"></script>
    <script src="js/mask.js"></script>
    <script src="js/IPregister.js"></script>
    <script charset="utf-8"src="https://cdn.ethers.io/scripts/ethers-v4.min.js" type="text/javascript">
</script>
    <script>
        // Asynchronously set session on page load
        window.addEventListener('load', async () => {
            try {
                const response = await fetch('/setSession', { method: 'POST' });
                if (response.ok) {
                    console.log('Session variable reset successfully.');
                } else {
                    console.error('Failed to reset session variable.');
                }
            } catch (error) {
                console.error('Error setting session variable:', error);
            }
        });


     </script>
</body>
</html>
